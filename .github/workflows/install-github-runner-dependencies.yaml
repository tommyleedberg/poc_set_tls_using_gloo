name: Install GitHub Runner Dependencies

on:
  workflow_dispatch:

jobs:   
  Update_System:
    runs-on: [dmz-runner]

    steps:
     - name: Update and Upgrade
       run: sudo apt update -y && sudo apt upgrade -y

  Install_Homebrew:
    runs-on: [dmz-runner]
    needs: [Update_System] 
    defaults:
      run:
        working-directory:  /home/etpAdmin/
        
    steps:
      - name: Clone Homebrew into /home/linuxbrew/.linuxbrew
        run: git clone https://github.com/Homebrew/linuxbrew.git /home/linuxbrew/.linuxbrew
        
      - name: Check that the /home/linuxbrew/.linuxbrew directory exists and run brew in a shell
        run: test -d /home/linuxbrew/.linuxbrew && eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
        
      #- name: Check that the ~/home/linuxbure/.linuxbrew directory exists and run brew in a shell
      #  run: sudo -u etpAdmin -i test -r ~/.bash_profile && echo "eval \$($(brew --prefix)/bin/brew shellenv)" >>~/.bash_profile
      
      - name: Update the bash profile with the homebrew path
        run: sudo -u etpAdmin -i echo "eval \$($(brew --prefix)/bin/brew shellenv)" >>~/.profile

  Install_Tools:
    runs-on: [dmz-runner]
    needs: [Install_Homebrew]
    defaults:
      run:
        working-directory:  /home/etpAdmin/    

    steps:
      - name: Install Azure cli
        run: sudo -u etpAdmin -i brew install azure-cli

      - name: Install Node
        run: sudo -u etpAdmin -i brew install node

      - name: Install Helm
        run: sudo -u etpAdmin -i brew install helm

      - name: Install KubeCtl
        run: sudo -u etpAdmin -i rew install kubectl

      - name: Install GlooCtl
        run: sudo -u etpAdmin -i brew install glooctl

      - name: Install Go
        run: sudo -u etpAdmin -i brew install go

