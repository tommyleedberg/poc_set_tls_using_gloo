name: Set Upstream TLS on a specified route

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: [self-hosted]
    steps:
      - name: Add certificate to K8s cert store
        run: kubectl create secret tls petstore-secret --key "C:\Users\dspAdmin\Desktop\wildcard-cert\wildcard-syseng.struxurewarecloud.com.key" --cert "wildcard-syseng.struxurewarecloud.com.crt" --namespace gloo-system

      - name: Set upstream to reference new secret
        run: glooctl edit us --name default-petstore-8080 --namespace gloo-system --ssl-secret-name petstore-secret --ssl-secret-namespace gloo-system
